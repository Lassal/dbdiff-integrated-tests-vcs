schema: CCR
name: PRCCR_APROVACAO_SLCT_CLNT_GRPO
routineType: PROCEDURE
returnParamater: null
parameters:
- name: CD_TIPO_SITUACAO
  ordinalPosition: 1
  dataType: VARCHAR2
  parameterMode: IN
- name: CD_USRO_VALIDACAO
  ordinalPosition: 2
  dataType: VARCHAR2
  parameterMode: IN
- name: CD_ARQUIVO
  ordinalPosition: 3
  dataType: NUMBER
  parameterMode: IN
- name: NU_REMESSA
  ordinalPosition: 4
  dataType: NUMBER
  parameterMode: IN
routineDefinition: "PROCEDURE PRCCR_APROVACAO_SLCT_CLNT_GRPO (\n  CD_TIPO_SITUACAO\
  \ IN VARCHAR2,\n  CD_USRO_VALIDACAO IN VARCHAR2,\n  CD_ARQUIVO IN NUMBER,\n  NU_REMESSA\
  \ IN NUMBER\n) AS TYPE SLCT_GRPO_REF_CURSOR IS REF CURSOR;\nSLCT_GRPO_CURSOR SLCT_GRPO_REF_CURSOR;\n\
  TYPE TBCCCR_SLCT_VLDC_TABLE IS TABLE OF CCR.TBCCRR_SLCT_VLDC_CLNT_GRPO % ROWTYPE;\n\
  SLCT_GRPO TBCCCR_SLCT_VLDC_TABLE;\nCONSULTA VARCHAR2(1000);\nBEGIN\n  CONSULTA:\
  \ = 'SELECT \n\n        CD_GRPO_EC,\n\n        TX_IDTR_CPF_CNPJ,\n\n        SG_TPPS,\n\
  \n        CD_BNDR,\n\n        CD_ARQV_PCSM_CDST,\n\n        NU_RMSA,\n\n       \
  \ IN_RGST_ATVO,\n\n        DH_INCL_RGST,\n\n        CD_USRO_INCL_RGST\n\n      \
  \  FROM CCR.TBCCRR_SLCT_VLDC_CLNT_GRPO\n\n        WHERE CD_ARQV_PCSM_CDST = :1\n\
  \n        AND NU_RMSA = :2';\nOPEN SLCT_GRPO_CURSOR FOR CONSULTA USING CD_ARQUIVO,\n\
  \  NU_REMESSA;\nLOOP\n  FETCH SLCT_GRPO_CURSOR BULK COLLECT INTO SLCT_GRPO\nLIMIT\n\
  \  10000;\nEXIT\n  WHEN SLCT_GRPO.COUNT = 0;\nFOR i IN 1 .. SLCT_GRPO.COUNT\nLOOP\n\
  \  IF CD_TIPO_SITUACAO = 'A' THEN -- Primeiramente Exclui as referencias para os\
  \ casos de atualização de grupos\nDELETE FROM\n  CCR.TBCCRR_CLNT_GRPO_EC\nWHERE\n\
  \  CD_GRPO_EC = SLCT_GRPO(i) .CD_GRPO_EC\n  AND TX_IDTR_CPF_CNPJ = SLCT_GRPO(i)\
  \ .TX_IDTR_CPF_CNPJ;\nINSERT INTO\n  CCR.TBCCRR_HSTR_CLNT_GRPO_EC (\n    CD_BNDR,\n\
  \    SG_TPPS,\n    TX_IDTR_CPF_CNPJ,\n    DH_HSTR,\n    CD_GRPO_EC,\n    CD_USRO_INCL_RGST,\n\
  \    DH_INCL_RGST\n  )\nVALUES\n  (\n    7,\n    SLCT_GRPO(i) .SG_TPPS,\n    SLCT_GRPO(i)\
  \ .TX_IDTR_CPF_CNPJ,\n    SYSDATE,\n    SLCT_GRPO(i) .CD_GRPO_EC,\n    SLCT_GRPO(i)\
  \ .CD_USRO_INCL_RGST,\n    SYSDATE\n  );\nINSERT INTO\n  CCR.TBCCRR_CLNT_GRPO_EC\
  \ (\n    CD_GRPO_EC,\n    TX_IDTR_CPF_CNPJ,\n    SG_TPPS,\n    IN_RGST_ATVO,\n \
  \   DH_INCL_RGST,\n    CD_USRO_INCL_RGST\n  )\nVALUES\n  (\n    SLCT_GRPO(i) .CD_GRPO_EC,\n\
  \    SLCT_GRPO(i) .TX_IDTR_CPF_CNPJ,\n    SLCT_GRPO(i) .SG_TPPS,\n    'S',\n   \
  \ SYSDATE,\n    SLCT_GRPO(i) .CD_USRO_INCL_RGST\n  );\nEND IF;\nDELETE FROM\n  CCR.TBCCRR_SLCT_VLDC_CLNT_GRPO\n\
  WHERE\n  CD_GRPO_EC = SLCT_GRPO(i) .CD_GRPO_EC\n  AND TX_IDTR_CPF_CNPJ = SLCT_GRPO(i)\
  \ .TX_IDTR_CPF_CNPJ\n  AND SG_TPPS = SLCT_GRPO(i) .SG_TPPS;\nEND\nLOOP;\nCOMMIT;\n\
  END\nLOOP;\nCLOSE SLCT_GRPO_CURSOR;\nUPDATE\n  CCR.TBCCRR_CNTR_RMSA_BNDR\nSET\n\
  \  DH_VLDC_RGST = SYSDATE,\n  CD_USRO_VLDC_RGST = CD_USRO_VALIDACAO,\n  CD_TIPO_STCO_SLCT\
  \ = CD_TIPO_SITUACAO\nWHERE\n  CD_ARQV_PCSM_CDST = CD_ARQUIVO\n  AND NU_RMSA = NU_REMESSA;\n\
  COMMIT;\nEND;"
