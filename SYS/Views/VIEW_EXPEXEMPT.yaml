schema: SYS
name: EXPEXEMPT
updatedAllowed: true
insertAllowed: true
columns:
- name: COUNT
  dataType: NUMBER
  nullable: true
  ordinalPosition: 1
  dataTypeLength:
referencedTables:
- schema: SYS
  name: SYSAUTH$
- schema: SYS
  name: SYSTEM_PRIVILEGE_MAP
viewDefinition: |-
  SELECT
    COUNT(*)
  FROM
    sys.sysauth$
  WHERE
    (
      privilege# = (
        SELECT
          privilege
        FROM
          sys.system_privilege_map
        WHERE
          name = 'EXEMPT ACCESS POLICY'
      )
    )
    AND grantee# = userenv('SCHEMAID')
    /* user directly has priv */
    OR (
      grantee# = userenv('SCHEMAID')
      /* user has role with priv */
      AND privilege# > 0
      AND privilege# IN (
        SELECT
          u1.privilege#
        FROM
          sys.sysauth$ u1,
          sys.sysauth$ u2
        WHERE
          u1.grantee# = userenv('SCHEMAID')
          AND u1.privilege# = u2.grantee#
          AND u2.privilege# = (
            SELECT
              privilege
            FROM
              sys.system_privilege_map
            WHERE
              name = 'EXEMPT ACCESS POLICY'
          )
      )
    )
