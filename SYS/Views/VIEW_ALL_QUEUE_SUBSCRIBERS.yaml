schema: SYS
name: ALL_QUEUE_SUBSCRIBERS
updatedAllowed: true
insertAllowed: true
columns:
- name: ADDRESS
  dataType: VARCHAR2
  textMaxLength: 1024
  nullable: true
  ordinalPosition: 5
  dataTypeLength: 1024
- name: CONSUMER_NAME
  dataType: VARCHAR2
  textMaxLength: 30
  nullable: true
  ordinalPosition: 4
  dataTypeLength: 30
- name: DELIVERY_MODE
  dataType: VARCHAR2
  textMaxLength: 22
  nullable: true
  ordinalPosition: 9
  dataTypeLength: 22
- name: IF_NONDURABLE_SUBSCRIBER
  dataType: VARCHAR2
  textMaxLength: 3
  nullable: true
  ordinalPosition: 10
  dataTypeLength: 3
- name: OWNER
  dataType: VARCHAR2
  textMaxLength: 128
  nullable: false
  ordinalPosition: 1
  dataTypeLength: 128
- name: POS_BITMAP
  dataType: NUMBER
  nullable: true
  ordinalPosition: 13
  dataTypeLength:
- name: PROTOCOL
  dataType: NUMBER
  nullable: true
  ordinalPosition: 6
  dataTypeLength:
- name: QUEUE_NAME
  dataType: VARCHAR2
  textMaxLength: 128
  nullable: false
  ordinalPosition: 2
  dataTypeLength: 128
- name: QUEUE_TABLE
  dataType: VARCHAR2
  textMaxLength: 128
  nullable: false
  ordinalPosition: 3
  dataTypeLength: 128
- name: QUEUE_TO_QUEUE
  dataType: VARCHAR2
  textMaxLength: 5
  nullable: true
  ordinalPosition: 11
  dataTypeLength: 5
- name: RULE
  dataType: CLOB
  nullable: true
  ordinalPosition: 8
  dataTypeLength:
- name: SUBSCRIBER_ID
  dataType: NUMBER
  nullable: true
  ordinalPosition: 12
  dataTypeLength:
- name: TRANSFORMATION
  dataType: VARCHAR2
  textMaxLength: 61
  nullable: true
  ordinalPosition: 7
  dataTypeLength: 61
referencedTables:
- schema: SYS
  name: DBA_RULES
- schema: SYS
  name: OBJ$
- schema: SYS
  name: OBJAUTH$
- schema: SYS
  name: USER$
- schema: SYS
  name: V$ENABLEDPRIVS
- schema: SYS
  name: X$KZSRO
- schema: SYSTEM
  name: AQ$_QUEUES
- schema: SYSTEM
  name: AQ$_QUEUE_TABLES
viewDefinition: |-
  select
    su.owner OWNER,
    su.queue_name QUEUE_NAME,
    su.queue_table QUEUE_TABLE,
    su.consumer_name CONSUMER_NAME,
    su.address ADDRESS,
    su.protocol PROTOCOL,
    su.transformation TRANSFORMATION,
    r.rule_condition RULE,
    decode(
      bitand(su.sub_type, 192),
      64,
      'PERSISTENT',
      128,
      'BUFFERED',
      192,
      'PERSISTENT_OR_BUFFERED',
      'NONE'
    ) DELIVERY_MODE,
    decode(
      bitand(su.sub_type, 32960),
      32960,
      'YES',
      'NO'
    ) IF_NONDURABLE_SUBSCRIBER,
    decode(bitand(su.sub_type, 512), 512, 'TRUE', 'FALSE') QUEUE_TO_QUEUE,
    su.subscriber_id SUBSCRIBER_ID,
    su.pos_bitmap POS_BITMAP
  FROM
    (
      select
        u.name OWNER,
        q.name QUEUE_NAME,
        t.name QUEUE_TABLE,
        s.name CONSUMER_NAME,
        s.address ADDRESS,
        s.protocol PROTOCOL,
        s.trans_name TRANSFORMATION,
        s.sub_type SUB_TYPE,
        s.rule_name RULE_NAME,
        s.subscriber_id SUBSCRIBER_ID,
        s.pos_bitmap POS_BITMAP
      FROM
        system.aq$_queues q,
        system.aq$_queue_tables t,
        sys.user$ u,
        sys.obj$ ro,
        sys.user$ cu,
        TABLE(
          aq$_get_subscribers(
            u.name,
            q.name,
            t.name,
            cu.name,
            q.eventid,
            t.flags
          )
        ) s
      where
        u.name = t.schema
        and q.table_objno = t.objno
        and bitand(t.flags, 1) = 1
        and q.usage != 1
        and ro.owner# = u.user#
        and ro.obj# = q.eventid
        and cu.user# = userenv('SCHEMAID')
        and (
          ro.owner# = userenv('SCHEMAID')
          or ro.obj# in (
            select
              oa.obj#
            from
              sys.objauth$ oa
            where
              oa.privilege# in (21, 41)
              and grantee# in (
                select
                  kzsrorol
                from
                  x$kzsro
              )
          )
          or exists (
            select
              null
            from
              v$enabledprivs
            where
              priv_number = -220
          )
          or ro.obj# in (
            select
              q.eventid
            from
              system.aq$_queues q,
              system.aq$_queue_tables t
            where
              q.table_objno = t.objno
              and bitand(t.flags, 8) = 0
              and exists (
                select
                  null
                from
                  sys.objauth$ oa,
                  sys.obj$ o
                where
                  oa.obj# = o.obj#
                  and (
                    o.name = 'DBMS_AQ'
                    or o.name = 'DBMS_AQADM'
                  )
                  and o.owner# = 0
                  and o.type# = 9
                  and oa.grantee# = userenv('SCHEMAID')
              )
          )
        )
    ) su,
    sys.dba_rules r
  where
    su.rule_name = r.rule_name(+)
    and su.owner = r.rule_owner(+)
