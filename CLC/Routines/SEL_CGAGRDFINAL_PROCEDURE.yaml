schema: CLC
name: SEL_CGAGRDFINAL
routineType: PROCEDURE
returnParamater: null
parameters:
- name: VDATAMOVIMENTO
  ordinalPosition: 1
  dataType: DATE
  parameterMode: IN
- name: VCREDENCIADORA
  ordinalPosition: 2
  dataType: NUMBER
  parameterMode: IN
- name: VPLATAFORMA
  ordinalPosition: 3
  dataType: VARCHAR2
  parameterMode: IN
- name: VTIPOORIGEM
  ordinalPosition: 4
  dataType: VARCHAR2
  parameterMode: IN
routineDefinition: "PROCEDURE SEL_CGAGRDFINAL (\n  vdataMovimento IN DATE,\n  vcredenciadora\
  \ IN NUMBER,\n  vplataforma IN VARCHAR,\n  vtipoOrigem IN VARCHAR\n) AS vdataMovimentoAux\
  \ DATE;\nvlinhasRemumeracaoAux NUMBER;\nvlinhasEmissorAux NUMBER;\nBEGIN\n  vdataMovimentoAux:\
  \ = vdataMovimento;\nvlinhasEmissorAux: = 0;\nvlinhasRemumeracaoAux: = 0;\nIF vdataMovimentoAux\
  \ IS NULL THEN\nSELECT\n  TRUNC(dt_pcsm_atul) INTO vdataMovimentoAux\nFROM\n  ccr.tbccrr_cicl_pcsm_cdst;\n\
  END IF;\nSELECT\n  COUNT(1) INTO vlinhasEmissorAux\nFROM\n  CLC.TBCLCR_RCBM_AGND_EMSR\n\
  WHERE\n  DT_RFRN_MVMN = vdataMovimentoAux\n  AND CD_TIPO_STCO_POCS_PGMN_LQDC = 5\n\
  \  AND CD_FRNT_TBHO = 2;\nSELECT\n  COUNT(1) INTO vlinhasRemumeracaoAux\nFROM\n\
  \  CLC.TBCLCR_PGMN_COND_RMNR_GRDE\nWHERE\n  DT_RFRN_MVMN = vdataMovimentoAux\n \
  \ AND CD_TIPO_STCO_POCS_PGMN_LQDC = 5\n  AND CD_FRNT_TBHO = 11;\nIF vtipoOrigem\
  \ = 'CRD' THEN IF vlinhasEmissorAux = 0 THEN --DELETA OS DADOS EXISTENTES DA GRADE\
  \ DA AG.EMISSOR\nDELETE FROM\n  CLC.TBCLCR_RCBM_AGND_EMSR\nWHERE\n  CD_CRDE = vcredenciadora\n\
  \  AND CD_TIPO_PLTF_PGMN = vplataforma\n  AND DT_RFRN_MVMN = vdataMovimentoAux --\t\
  \t\tAND\t\tCD_TIPO_STCO_GRDE = 1\n  AND CD_FRNT_TBHO = 2\n  AND CD_CRDE <> 7253;\n\
  --TRANSITORIO CIELO\n  --POPULA NOVAMENTE OS DADOS DA AG.EMISSOR\nINSERT INTO\n\
  \  CLC.TBCLCR_RCBM_AGND_EMSR (\n    CD_BNDR,\n    DT_VNCM_TRNS,\n    NU_BNCO_LQDN,\n\
  \    CD_TIPO_PLTF_PGMN,\n    CD_CRDE,\n    CD_EMSR,\n    CD_PCSR,\n    CD_MODA,\n\
  \    CD_TIPO_STCO_GRDE,\n    VL_LQDO_TRNS_ETNC,\n    DH_INCL_RGST,\n    CD_USRO_INCL_RGST,\n\
  \    DT_RFRN_MVMN,\n    CD_FRNT_TBHO,\n    VL_AJST_GRDE,\n    CD_TIPO_ACAO_RGST,\n\
  \    CD_USRO_ACAO_RGST,\n    CD_TIPO_STCO_POCS_PGMN_PCSM,\n    CD_TIPO_STCO_POCS_PGMN_LQDC,\n\
  \    TBC_DT_VNCM_TRNS,\n    QT_TOTL_LNCM_BNDR,\n    CD_CICL_LQDC_CIP\n  )\nSELECT\n\
  \  CD_BNDR,\n  DT_VNCM_MVMN,\n  NU_BNCO_LQDN,\n  CD_TIPO_PLTF_PGMN,\n  CD_CRDE,\n\
  \  CD_EMSR,\n  CD_PCSR,\n  CD_MODA,\n  1,\n  SUM(\n    case\n      CD_TIPO_OPRD\n\
  \      when 2 then (VL_TOTL_LNCM_BNDR - VL_ITCM_BNDR) * -1\n      ELSE (VL_TOTL_LNCM_BNDR\
  \ - VL_ITCM_BNDR)\n    END\n  ) * -1 AS valor_liquido,\n  SYSDATE,\n  'Grade Unificada',\n\
  \  DT_RFRN_MVMN,\n  2,\n  NULL,\n  'I',\n  'Grade Unificada',\n  1,\n  1,\n  NULL,\n\
  \  SUM(QT_TRNS_ETNC),\n  NULL\nFROM\n  CLC.TBCLCR_LQDC_GRDE\nWHERE\n  CD_CRDE =\
  \ vcredenciadora\n  AND CD_TIPO_PLTF_PGMN = vplataforma\n  AND DT_RFRN_MVMN = vdataMovimentoAux\n\
  GROUP BY\n  CD_BNDR,\n  DT_VNCM_MVMN,\n  NU_BNCO_LQDN,\n  CD_TIPO_PLTF_PGMN,\n \
  \ CD_CRDE,\n  CD_EMSR,\n  CD_PCSR,\n  CD_MODA,\n  DT_RFRN_MVMN;\nEND IF;\nIF vlinhasRemumeracaoAux\
  \ = 0 THEN --DELETA OS DADOS EXISTENTES DA GRADE DA AG.REMUNERA플O\nDELETE FROM\n\
  \  CLC.TBCLCR_PGMN_COND_RMNR_GRDE\nWHERE\n  CD_CRDE = vcredenciadora\n  AND CD_TIPO_PLTF_PGMN\
  \ = vplataforma\n  AND DT_RFRN_MVMN = vdataMovimentoAux --\t\t\tAND\t\tCD_TIPO_STCO_GRDE\
  \ = 1\n  AND CD_FRNT_TBHO = 11\n  AND CD_CRDE <> 7253;\n--TRANSITORIO CIELO\n  --POPULA\
  \ NOVAMENTE OS DADOS DA AG.REMUNERA플O\nINSERT INTO\n  CLC.TBCLCR_PGMN_COND_RMNR_GRDE(\n\
  \    CD_BNDR,\n    CD_CRDE,\n    CD_TIPO_PLTF_PGMN,\n    NU_BNCO_PGMN_CRDE,\n  \
  \  DT_RFRN_MVMN,\n    DT_VNCM_TRNS,\n    CD_TIPO_STCO_GRDE,\n    VL_LQDO_COND_RMNR_BNDR,\n\
  \    DH_INCL_RGST,\n    CD_USRO_INCL_RGST,\n    CD_FRNT_TBHO,\n    VL_AJST_GRDE,\n\
  \    CD_TIPO_ACAO_RGST,\n    CD_USRO_ACAO_RGST,\n    CD_TIPO_STCO_POCS_PGMN_PCSM,\n\
  \    CD_TIPO_STCO_POCS_PGMN_LQDC,\n    DT_VNCM_TRNS_ORIG,\n    QT_TOTL_LNCM_BNDR\n\
  \  )\nSELECT\n  GRDE.CD_BNDR,\n  GRDE.CD_CRDE,\n  GRDE.CD_TIPO_PLTF_PGMN,\n  CREDENCIADORA.NU_BNCO_PGMN_CRDE,\n\
  \  GRDE.DT_RFRN_MVMN,\n  GRDE.DT_VNCM_MVMN,\n  1 AS CD_TIPO_STCO_GRDE,\n  (\n  \
  \  DADOS_REMUNERACAO.valor_REM - DADOS_IMPOSTO.valor_TRIBUTO\n  ) * -1 AS VALOR_LIQUIDO,\n\
  \  sysdate AS DH_INCL_RGST,\n  'Grade Unificada' AS CD_USRO_INCL_RGST,\n  11 AS\
  \ CD_FRNT_TBHO,\n  null AS VL_AJST_GRDE,\n  'I' AS CD_TIPO_ACAO_RGST,\n  'Grade\
  \ Unificada' AS CD_USRO_ACAO_RGST,\n  1 AS CD_TIPO_STCO_POCS_PGMN_PCSM,\n  1 AS\
  \ CD_TIPO_STCO_POCS_PGMN_LQDC,\n  null AS DT_VNCM_TRNS_ORIG,\n  SUM(GRDE.QT_TRNS_ETNC)\
  \ AS TOTAL_TRANSACOES\nFROM\n  CLC.TBCLCR_LQDC_GRDE GRDE\n  INNER JOIN (\n    SELECT\n\
  \      GERAL.CD_BNDR,\n      GERAL.CD_CRDE,\n      GERAL.CD_TIPO_PLTF_PGMN,\n  \
  \    GERAL.DT_RFRN_MVMN,\n      GERAL.DT_VNCM_MVMN,\n      SUM(\n        case\n\
  \          GERAL.CD_TIPO_OPRD\n          when 2 then (COBRANCA.VL_RMNR_BNDR) * -1\n\
  \          ELSE (COBRANCA.VL_RMNR_BNDR)\n        END\n      ) AS valor_REM\n   \
  \ FROM\n      CLC.TBCLCR_LQDC_GRDE geral\n      INNER JOIN CLC.TBCLCR_LQDC_GRDE_CBRN\
  \ cobranca ON GERAL.CD_BNDR = COBRANCA.CD_BNDR\n      AND GERAL.CD_CRDE = COBRANCA.CD_CRDE\n\
  \      AND GERAL.CD_TIPO_PLTF_PGMN = COBRANCA.CD_TIPO_PLTF_PGMN\n      AND GERAL.CD_EMSR\
  \ = COBRANCA.CD_EMSR\n      AND GERAL.CD_TIPO_TRNS_BNDR = COBRANCA.CD_TIPO_TRNS_BNDR\n\
  \      AND GERAL.CD_PRDT_BNDR = COBRANCA.CD_PRDT_BNDR\n      AND GERAL.CD_TIPO_TRNS_BNDR_ORGM\
  \ = COBRANCA.CD_TIPO_TRNS_BNDR_ORGM\n      AND GERAL.SG_ORGM_IFMC = COBRANCA.SG_ORGM_IFMC\n\
  \      AND GERAL.DT_RFRN_MVMN = COBRANCA.DT_RFRN_MVMN\n      AND GERAL.DT_VNCM_MVMN\
  \ = COBRANCA.DT_VNCM_MVMN\n      AND GERAL.NU_RMSA_CRDE = COBRANCA.NU_RMSA_CRDE\n\
  \      AND GERAL.NU_RMSA_EMSR = COBRANCA.NU_RMSA_EMSR\n      AND GERAL.CD_TIPO_APRS_TRNS\
  \ = COBRANCA.CD_TIPO_APRS_TRNS\n      AND GERAL.CD_PCSR = COBRANCA.CD_PCSR\n   \
  \ WHERE\n      GERAL.DT_RFRN_MVMN = vdataMovimentoAux\n      and GERAL.CD_TIPO_PLTF_PGMN\
  \ = vplataforma\n      and GERAL.CD_CRDE = vcredenciadora\n    GROUP BY\n      GERAL.CD_BNDR,\n\
  \      GERAL.CD_CRDE,\n      GERAL.CD_TIPO_PLTF_PGMN,\n      GERAL.DT_RFRN_MVMN,\n\
  \      GERAL.DT_VNCM_MVMN\n  ) DADOS_REMUNERACAO ON GRDE.CD_BNDR = DADOS_REMUNERACAO.CD_BNDR\n\
  \  AND GRDE.CD_CRDE = DADOS_REMUNERACAO.CD_CRDE\n  AND GRDE.CD_TIPO_PLTF_PGMN =\
  \ DADOS_REMUNERACAO.CD_TIPO_PLTF_PGMN\n  AND GRDE.DT_RFRN_MVMN = DADOS_REMUNERACAO.DT_RFRN_MVMN\n\
  \  AND GRDE.DT_VNCM_MVMN = DADOS_REMUNERACAO.DT_VNCM_MVMN\n  INNER JOIN (\n    SELECT\n\
  \      DADOS_IMP_AGRP_ROUND.CD_BNDR,\n      DADOS_IMP_AGRP_ROUND.CD_CRDE,\n    \
  \  DADOS_IMP_AGRP_ROUND.CD_TIPO_PLTF_PGMN,\n      DADOS_IMP_AGRP_ROUND.DT_RFRN_MVMN,\n\
  \      DADOS_IMP_AGRP_ROUND.DT_VNCM_MVMN,\n      SUM(DADOS_IMP_AGRP_ROUND.valor_TRIBUTO_AGRP)\
  \ AS valor_TRIBUTO\n    FROM\n      (\n        SELECT\n          TRIBUTO.CD_BNDR,\n\
  \          TRIBUTO.CD_CRDE,\n          TRIBUTO.CD_TIPO_PLTF_PGMN,\n          TRIBUTO.CD_EMSR,\n\
  \          --TRIBUTO.CD_PCSR                ,\n          TRIBUTO.CD_TIPO_TRNS_BNDR,\n\
  \          TRIBUTO.CD_PRDT_BNDR,\n          TRIBUTO.CD_TIPO_TRNS_BNDR_ORGM,\n  \
  \        TRIBUTO.SG_ORGM_IFMC,\n          TRIBUTO.DT_RFRN_MVMN,\n          TRIBUTO.DT_VNCM_MVMN,\n\
  \          TRIBUTO.CD_TIPO_APRS_TRNS,\n          TRIBUTO.CD_TIPO_FOMA_CBRN_BNDR,\n\
  \          TRIBUTO.CD_TRBT,\n          TRIBUTO.CD_TIPO_ALQT_TRBT,\n          ROUND(\n\
  \            SUM(\n              case\n                GERAL2.CD_TIPO_OPRD\n   \
  \             when 2 then (TRIBUTO.VL_TRBT_RMNR_BNDR_VNDA) * -1\n              \
  \  ELSE (TRIBUTO.VL_TRBT_RMNR_BNDR_VNDA)\n              END\n            ),\n  \
  \          2\n          ) AS valor_TRIBUTO_AGRP\n        FROM\n          CLC.TBCLCR_LQDC_GRDE\
  \ geral2\n          INNER JOIN CLC.TBCLCR_LQDC_GRDE_CBRN cobranca2 ON GERAL2.CD_BNDR\
  \ = COBRANCA2.CD_BNDR\n          AND GERAL2.CD_CRDE = COBRANCA2.CD_CRDE\n      \
  \    AND GERAL2.CD_TIPO_PLTF_PGMN = COBRANCA2.CD_TIPO_PLTF_PGMN\n          AND GERAL2.CD_EMSR\
  \ = COBRANCA2.CD_EMSR\n          AND GERAL2.CD_TIPO_TRNS_BNDR = COBRANCA2.CD_TIPO_TRNS_BNDR\n\
  \          AND GERAL2.CD_PRDT_BNDR = COBRANCA2.CD_PRDT_BNDR\n          AND GERAL2.CD_TIPO_TRNS_BNDR_ORGM\
  \ = COBRANCA2.CD_TIPO_TRNS_BNDR_ORGM\n          AND GERAL2.SG_ORGM_IFMC = COBRANCA2.SG_ORGM_IFMC\n\
  \          AND GERAL2.DT_RFRN_MVMN = COBRANCA2.DT_RFRN_MVMN\n          AND GERAL2.DT_VNCM_MVMN\
  \ = COBRANCA2.DT_VNCM_MVMN\n          AND GERAL2.NU_RMSA_CRDE = COBRANCA2.NU_RMSA_CRDE\n\
  \          AND GERAL2.NU_RMSA_EMSR = COBRANCA2.NU_RMSA_EMSR\n          AND GERAL2.CD_TIPO_APRS_TRNS\
  \ = COBRANCA2.CD_TIPO_APRS_TRNS\n          AND GERAL2.CD_PCSR = COBRANCA2.CD_PCSR\n\
  \          INNER JOIN CLC.TBCLCR_LQDC_GRDE_TRBT TRIBUTO ON TRIBUTO.CD_BNDR = COBRANCA2.CD_BNDR\n\
  \          AND TRIBUTO.CD_CRDE = COBRANCA2.CD_CRDE\n          AND TRIBUTO.CD_TIPO_PLTF_PGMN\
  \ = COBRANCA2.CD_TIPO_PLTF_PGMN\n          AND TRIBUTO.CD_EMSR = COBRANCA2.CD_EMSR\n\
  \          AND TRIBUTO.CD_TIPO_TRNS_BNDR = COBRANCA2.CD_TIPO_TRNS_BNDR\n       \
  \   AND TRIBUTO.CD_PRDT_BNDR = COBRANCA2.CD_PRDT_BNDR\n          AND TRIBUTO.CD_TIPO_TRNS_BNDR_ORGM\
  \ = COBRANCA2.CD_TIPO_TRNS_BNDR_ORGM\n          AND TRIBUTO.SG_ORGM_IFMC = COBRANCA2.SG_ORGM_IFMC\n\
  \          AND TRIBUTO.DT_RFRN_MVMN = COBRANCA2.DT_RFRN_MVMN\n          AND TRIBUTO.DT_VNCM_MVMN\
  \ = COBRANCA2.DT_VNCM_MVMN\n          AND TRIBUTO.NU_RMSA_CRDE = COBRANCA2.NU_RMSA_CRDE\n\
  \          AND TRIBUTO.NU_RMSA_EMSR = COBRANCA2.NU_RMSA_EMSR\n          AND TRIBUTO.CD_TIPO_APRS_TRNS\
  \ = COBRANCA2.CD_TIPO_APRS_TRNS\n          AND TRIBUTO.CD_PCSR = COBRANCA2.CD_PCSR\n\
  \          AND TRIBUTO.CD_TIPO_FOMA_CBRN_BNDR = COBRANCA2.CD_TIPO_FOMA_CBRN_BNDR\n\
  \        WHERE\n          GERAL2.DT_RFRN_MVMN = vdataMovimentoAux\n          and\
  \ GERAL2.CD_TIPO_PLTF_PGMN = vplataforma\n          AND GERAL2.CD_CRDE = vcredenciadora\n\
  \          AND TRIBUTO.CD_TIPO_ALQT_TRBT = 2\n        GROUP BY\n          TRIBUTO.CD_BNDR,\n\
  \          TRIBUTO.CD_CRDE,\n          TRIBUTO.CD_TIPO_PLTF_PGMN,\n          TRIBUTO.CD_EMSR,\n\
  \          --TRIBUTO.CD_PCSR                ,\n          TRIBUTO.CD_TIPO_TRNS_BNDR,\n\
  \          TRIBUTO.CD_PRDT_BNDR,\n          TRIBUTO.CD_TIPO_TRNS_BNDR_ORGM,\n  \
  \        TRIBUTO.SG_ORGM_IFMC,\n          TRIBUTO.DT_RFRN_MVMN,\n          TRIBUTO.DT_VNCM_MVMN,\n\
  \          TRIBUTO.CD_TIPO_APRS_TRNS,\n          TRIBUTO.CD_TIPO_FOMA_CBRN_BNDR,\n\
  \          TRIBUTO.CD_TRBT,\n          TRIBUTO.CD_TIPO_ALQT_TRBT\n      ) DADOS_IMP_AGRP_ROUND\n\
  \    GROUP BY\n      DADOS_IMP_AGRP_ROUND.CD_BNDR,\n      DADOS_IMP_AGRP_ROUND.CD_CRDE,\n\
  \      DADOS_IMP_AGRP_ROUND.CD_TIPO_PLTF_PGMN,\n      DADOS_IMP_AGRP_ROUND.DT_RFRN_MVMN,\n\
  \      DADOS_IMP_AGRP_ROUND.DT_VNCM_MVMN\n  ) DADOS_IMPOSTO ON DADOS_IMPOSTO.CD_BNDR\
  \ = DADOS_REMUNERACAO.CD_BNDR\n  AND DADOS_IMPOSTO.CD_CRDE = DADOS_REMUNERACAO.CD_CRDE\n\
  \  AND DADOS_IMPOSTO.CD_TIPO_PLTF_PGMN = DADOS_REMUNERACAO.CD_TIPO_PLTF_PGMN\n \
  \ AND DADOS_IMPOSTO.DT_RFRN_MVMN = DADOS_REMUNERACAO.DT_RFRN_MVMN\n  AND DADOS_IMPOSTO.DT_VNCM_MVMN\
  \ = DADOS_REMUNERACAO.DT_VNCM_MVMN\n  INNER JOIN CCR.TBCCRR_CRDE_BNDR CREDENCIADORA\
  \ ON GRDE.CD_BNDR = CREDENCIADORA.CD_BNDR\n  AND GRDE.CD_CRDE = CREDENCIADORA.CD_CRDE\n\
  WHERE\n  GRDE.DT_RFRN_MVMN = vdataMovimentoAux\n  and GRDE.CD_TIPO_PLTF_PGMN = vplataforma\n\
  \  and GRDE.CD_CRDE = vcredenciadora\ngroup by\n  GRDE.CD_BNDR,\n  GRDE.CD_CRDE,\n\
  \  GRDE.CD_TIPO_PLTF_PGMN,\n  GRDE.DT_RFRN_MVMN,\n  GRDE.DT_VNCM_MVMN,\n  CREDENCIADORA.NU_BNCO_PGMN_CRDE,\n\
  \  DADOS_REMUNERACAO.valor_REM,\n  DADOS_IMPOSTO.valor_TRIBUTO;\nEND IF;\nELSE --QUANDO\
  \ FOR UMA EXECU플O DO TIPO EMI, OS DADOS DE TODAS AS CREDENCIADORAS DEVEM SER DELETADOS\
  \ E RECARREGADOS\nIF vlinhasEmissorAux = 0 THEN --DELETA OS DADOS EXISTENTES DA\
  \ GRADE DA AG.EMISSOR\nDELETE FROM\n  CLC.TBCLCR_RCBM_AGND_EMSR\nWHERE\n  DT_RFRN_MVMN\
  \ = vdataMovimentoAux --\t\t\tAND\t\tCD_TIPO_STCO_GRDE = 1\n  AND CD_FRNT_TBHO =\
  \ 2\n  AND CD_CRDE <> 7253;\n--TRANSITORIO CIELO\n  --CARREGA NOVAMENTE OS DADOS\
  \ DA AG.EMISSOR\nINSERT INTO\n  CLC.TBCLCR_RCBM_AGND_EMSR (\n    CD_BNDR,\n    DT_VNCM_TRNS,\n\
  \    NU_BNCO_LQDN,\n    CD_TIPO_PLTF_PGMN,\n    CD_CRDE,\n    CD_EMSR,\n    CD_PCSR,\n\
  \    CD_MODA,\n    CD_TIPO_STCO_GRDE,\n    VL_LQDO_TRNS_ETNC,\n    DH_INCL_RGST,\n\
  \    CD_USRO_INCL_RGST,\n    DT_RFRN_MVMN,\n    CD_FRNT_TBHO,\n    VL_AJST_GRDE,\n\
  \    CD_TIPO_ACAO_RGST,\n    CD_USRO_ACAO_RGST,\n    CD_TIPO_STCO_POCS_PGMN_PCSM,\n\
  \    CD_TIPO_STCO_POCS_PGMN_LQDC,\n    TBC_DT_VNCM_TRNS,\n    QT_TOTL_LNCM_BNDR,\n\
  \    CD_CICL_LQDC_CIP\n  )\nSELECT\n  CD_BNDR,\n  DT_VNCM_MVMN,\n  NU_BNCO_LQDN,\n\
  \  CD_TIPO_PLTF_PGMN,\n  CD_CRDE,\n  CD_EMSR,\n  CD_PCSR,\n  CD_MODA,\n  1,\n  SUM(\n\
  \    case\n      CD_TIPO_OPRD\n      when 2 then (VL_TOTL_LNCM_BNDR - VL_ITCM_BNDR)\
  \ * -1\n      ELSE (VL_TOTL_LNCM_BNDR - VL_ITCM_BNDR)\n    END\n  ) * -1 AS valor_liquido,\n\
  \  SYSDATE,\n  'Grade Unificada',\n  DT_RFRN_MVMN,\n  2,\n  NULL,\n  'I',\n  'Grade\
  \ Unificada',\n  1,\n  1,\n  NULL,\n  SUM(QT_TRNS_ETNC),\n  NULL\nFROM\n  CLC.TBCLCR_LQDC_GRDE\n\
  WHERE\n  DT_RFRN_MVMN = vdataMovimentoAux\nGROUP BY\n  CD_BNDR,\n  DT_VNCM_MVMN,\n\
  \  NU_BNCO_LQDN,\n  CD_TIPO_PLTF_PGMN,\n  CD_CRDE,\n  CD_EMSR,\n  CD_PCSR,\n  CD_MODA,\n\
  \  DT_RFRN_MVMN;\nEND IF;\nIF vlinhasRemumeracaoAux = 0 THEN --DELETA OS DADOS EXISTENTES\
  \ DA GRADE DA AG.REMUNERA플O\nDELETE FROM\n  CLC.TBCLCR_PGMN_COND_RMNR_GRDE\nWHERE\n\
  \  DT_RFRN_MVMN = vdataMovimentoAux --\t\t\tAND\t\tCD_TIPO_STCO_GRDE = 1\n  AND\
  \ CD_FRNT_TBHO = 11\n  AND CD_CRDE <> 7253;\n--TRANSITORIO CIELO\n  --POPULA NOVAMENTE\
  \ OS DADOS DA AG.REMUNERA플O\nINSERT INTO\n  CLC.TBCLCR_PGMN_COND_RMNR_GRDE(\n \
  \   CD_BNDR,\n    CD_CRDE,\n    CD_TIPO_PLTF_PGMN,\n    NU_BNCO_PGMN_CRDE,\n   \
  \ DT_RFRN_MVMN,\n    DT_VNCM_TRNS,\n    CD_TIPO_STCO_GRDE,\n    VL_LQDO_COND_RMNR_BNDR,\n\
  \    DH_INCL_RGST,\n    CD_USRO_INCL_RGST,\n    CD_FRNT_TBHO,\n    VL_AJST_GRDE,\n\
  \    CD_TIPO_ACAO_RGST,\n    CD_USRO_ACAO_RGST,\n    CD_TIPO_STCO_POCS_PGMN_PCSM,\n\
  \    CD_TIPO_STCO_POCS_PGMN_LQDC,\n    DT_VNCM_TRNS_ORIG,\n    QT_TOTL_LNCM_BNDR\n\
  \  )\nSELECT\n  GRDE.CD_BNDR,\n  GRDE.CD_CRDE,\n  GRDE.CD_TIPO_PLTF_PGMN,\n  CREDENCIADORA.NU_BNCO_PGMN_CRDE,\n\
  \  GRDE.DT_RFRN_MVMN,\n  GRDE.DT_VNCM_MVMN,\n  1 AS CD_TIPO_STCO_GRDE,\n  (\n  \
  \  DADOS_REMUNERACAO.valor_REM - DADOS_IMPOSTO.valor_TRIBUTO\n  ) * -1 AS VALOR_LIQUIDO,\n\
  \  sysdate AS DH_INCL_RGST,\n  'Grade Unificada' AS CD_USRO_INCL_RGST,\n  11 AS\
  \ CD_FRNT_TBHO,\n  null AS VL_AJST_GRDE,\n  'I' AS CD_TIPO_ACAO_RGST,\n  'Grade\
  \ Unificada' AS CD_USRO_ACAO_RGST,\n  1 AS CD_TIPO_STCO_POCS_PGMN_PCSM,\n  1 AS\
  \ CD_TIPO_STCO_POCS_PGMN_LQDC,\n  null AS DT_VNCM_TRNS_ORIG,\n  SUM(GRDE.QT_TRNS_ETNC)\
  \ AS TOTAL_TRANSACOES\nFROM\n  CLC.TBCLCR_LQDC_GRDE GRDE\n  INNER JOIN (\n    SELECT\n\
  \      GERAL.CD_BNDR,\n      GERAL.CD_CRDE,\n      GERAL.CD_TIPO_PLTF_PGMN,\n  \
  \    GERAL.DT_RFRN_MVMN,\n      GERAL.DT_VNCM_MVMN,\n      SUM(\n        case\n\
  \          GERAL.CD_TIPO_OPRD\n          when 2 then (COBRANCA.VL_RMNR_BNDR) * -1\n\
  \          ELSE (COBRANCA.VL_RMNR_BNDR)\n        END\n      ) AS valor_REM\n   \
  \ FROM\n      CLC.TBCLCR_LQDC_GRDE geral\n      INNER JOIN CLC.TBCLCR_LQDC_GRDE_CBRN\
  \ cobranca ON GERAL.CD_BNDR = COBRANCA.CD_BNDR\n      AND GERAL.CD_CRDE = COBRANCA.CD_CRDE\n\
  \      AND GERAL.CD_TIPO_PLTF_PGMN = COBRANCA.CD_TIPO_PLTF_PGMN\n      AND GERAL.CD_EMSR\
  \ = COBRANCA.CD_EMSR\n      AND GERAL.CD_TIPO_TRNS_BNDR = COBRANCA.CD_TIPO_TRNS_BNDR\n\
  \      AND GERAL.CD_PRDT_BNDR = COBRANCA.CD_PRDT_BNDR\n      AND GERAL.CD_TIPO_TRNS_BNDR_ORGM\
  \ = COBRANCA.CD_TIPO_TRNS_BNDR_ORGM\n      AND GERAL.SG_ORGM_IFMC = COBRANCA.SG_ORGM_IFMC\n\
  \      AND GERAL.DT_RFRN_MVMN = COBRANCA.DT_RFRN_MVMN\n      AND GERAL.DT_VNCM_MVMN\
  \ = COBRANCA.DT_VNCM_MVMN\n      AND GERAL.NU_RMSA_CRDE = COBRANCA.NU_RMSA_CRDE\n\
  \      AND GERAL.NU_RMSA_EMSR = COBRANCA.NU_RMSA_EMSR\n      AND GERAL.CD_TIPO_APRS_TRNS\
  \ = COBRANCA.CD_TIPO_APRS_TRNS\n      AND GERAL.CD_PCSR = COBRANCA.CD_PCSR\n   \
  \ WHERE\n      GERAL.DT_RFRN_MVMN = vdataMovimentoAux\n    GROUP BY\n      GERAL.CD_BNDR,\n\
  \      GERAL.CD_CRDE,\n      GERAL.CD_TIPO_PLTF_PGMN,\n      GERAL.DT_RFRN_MVMN,\n\
  \      GERAL.DT_VNCM_MVMN\n  ) DADOS_REMUNERACAO ON GRDE.CD_BNDR = DADOS_REMUNERACAO.CD_BNDR\n\
  \  AND GRDE.CD_CRDE = DADOS_REMUNERACAO.CD_CRDE\n  AND GRDE.CD_TIPO_PLTF_PGMN =\
  \ DADOS_REMUNERACAO.CD_TIPO_PLTF_PGMN\n  AND GRDE.DT_RFRN_MVMN = DADOS_REMUNERACAO.DT_RFRN_MVMN\n\
  \  AND GRDE.DT_VNCM_MVMN = DADOS_REMUNERACAO.DT_VNCM_MVMN\n  INNER JOIN (\n    SELECT\n\
  \      DADOS_IMP_AGRP_ROUND.CD_BNDR,\n      DADOS_IMP_AGRP_ROUND.CD_CRDE,\n    \
  \  DADOS_IMP_AGRP_ROUND.CD_TIPO_PLTF_PGMN,\n      DADOS_IMP_AGRP_ROUND.DT_RFRN_MVMN,\n\
  \      DADOS_IMP_AGRP_ROUND.DT_VNCM_MVMN,\n      SUM(DADOS_IMP_AGRP_ROUND.valor_TRIBUTO_AGRP)\
  \ AS valor_TRIBUTO\n    FROM\n      (\n        SELECT\n          TRIBUTO.CD_BNDR,\n\
  \          TRIBUTO.CD_CRDE,\n          TRIBUTO.CD_TIPO_PLTF_PGMN,\n          TRIBUTO.CD_EMSR,\n\
  \          --TRIBUTO.CD_PCSR                ,\n          TRIBUTO.CD_TIPO_TRNS_BNDR,\n\
  \          TRIBUTO.CD_PRDT_BNDR,\n          TRIBUTO.CD_TIPO_TRNS_BNDR_ORGM,\n  \
  \        TRIBUTO.SG_ORGM_IFMC,\n          TRIBUTO.DT_RFRN_MVMN,\n          TRIBUTO.DT_VNCM_MVMN,\n\
  \          TRIBUTO.CD_TIPO_APRS_TRNS,\n          TRIBUTO.CD_TIPO_FOMA_CBRN_BNDR,\n\
  \          TRIBUTO.CD_TRBT,\n          TRIBUTO.CD_TIPO_ALQT_TRBT,\n          ROUND(\n\
  \            SUM(\n              case\n                GERAL2.CD_TIPO_OPRD\n   \
  \             when 2 then (TRIBUTO.VL_TRBT_RMNR_BNDR_VNDA) * -1\n              \
  \  ELSE (TRIBUTO.VL_TRBT_RMNR_BNDR_VNDA)\n              END\n            ),\n  \
  \          2\n          ) AS valor_TRIBUTO_AGRP\n        FROM\n          CLC.TBCLCR_LQDC_GRDE\
  \ geral2\n          INNER JOIN CLC.TBCLCR_LQDC_GRDE_CBRN cobranca2 ON GERAL2.CD_BNDR\
  \ = COBRANCA2.CD_BNDR\n          AND GERAL2.CD_CRDE = COBRANCA2.CD_CRDE\n      \
  \    AND GERAL2.CD_TIPO_PLTF_PGMN = COBRANCA2.CD_TIPO_PLTF_PGMN\n          AND GERAL2.CD_EMSR\
  \ = COBRANCA2.CD_EMSR\n          AND GERAL2.CD_TIPO_TRNS_BNDR = COBRANCA2.CD_TIPO_TRNS_BNDR\n\
  \          AND GERAL2.CD_PRDT_BNDR = COBRANCA2.CD_PRDT_BNDR\n          AND GERAL2.CD_TIPO_TRNS_BNDR_ORGM\
  \ = COBRANCA2.CD_TIPO_TRNS_BNDR_ORGM\n          AND GERAL2.SG_ORGM_IFMC = COBRANCA2.SG_ORGM_IFMC\n\
  \          AND GERAL2.DT_RFRN_MVMN = COBRANCA2.DT_RFRN_MVMN\n          AND GERAL2.DT_VNCM_MVMN\
  \ = COBRANCA2.DT_VNCM_MVMN\n          AND GERAL2.NU_RMSA_CRDE = COBRANCA2.NU_RMSA_CRDE\n\
  \          AND GERAL2.NU_RMSA_EMSR = COBRANCA2.NU_RMSA_EMSR\n          AND GERAL2.CD_TIPO_APRS_TRNS\
  \ = COBRANCA2.CD_TIPO_APRS_TRNS\n          AND GERAL2.CD_PCSR = COBRANCA2.CD_PCSR\n\
  \          INNER JOIN CLC.TBCLCR_LQDC_GRDE_TRBT TRIBUTO ON TRIBUTO.CD_BNDR = COBRANCA2.CD_BNDR\n\
  \          AND TRIBUTO.CD_CRDE = COBRANCA2.CD_CRDE\n          AND TRIBUTO.CD_TIPO_PLTF_PGMN\
  \ = COBRANCA2.CD_TIPO_PLTF_PGMN\n          AND TRIBUTO.CD_EMSR = COBRANCA2.CD_EMSR\n\
  \          AND TRIBUTO.CD_TIPO_TRNS_BNDR = COBRANCA2.CD_TIPO_TRNS_BNDR\n       \
  \   AND TRIBUTO.CD_PRDT_BNDR = COBRANCA2.CD_PRDT_BNDR\n          AND TRIBUTO.CD_TIPO_TRNS_BNDR_ORGM\
  \ = COBRANCA2.CD_TIPO_TRNS_BNDR_ORGM\n          AND TRIBUTO.SG_ORGM_IFMC = COBRANCA2.SG_ORGM_IFMC\n\
  \          AND TRIBUTO.DT_RFRN_MVMN = COBRANCA2.DT_RFRN_MVMN\n          AND TRIBUTO.DT_VNCM_MVMN\
  \ = COBRANCA2.DT_VNCM_MVMN\n          AND TRIBUTO.NU_RMSA_CRDE = COBRANCA2.NU_RMSA_CRDE\n\
  \          AND TRIBUTO.NU_RMSA_EMSR = COBRANCA2.NU_RMSA_EMSR\n          AND TRIBUTO.CD_TIPO_APRS_TRNS\
  \ = COBRANCA2.CD_TIPO_APRS_TRNS\n          AND TRIBUTO.CD_PCSR = COBRANCA2.CD_PCSR\n\
  \          AND TRIBUTO.CD_TIPO_FOMA_CBRN_BNDR = COBRANCA2.CD_TIPO_FOMA_CBRN_BNDR\n\
  \        WHERE\n          GERAL2.DT_RFRN_MVMN = vdataMovimentoAux\n          AND\
  \ TRIBUTO.CD_TIPO_ALQT_TRBT = 2\n        GROUP BY\n          TRIBUTO.CD_BNDR,\n\
  \          TRIBUTO.CD_CRDE,\n          TRIBUTO.CD_TIPO_PLTF_PGMN,\n          TRIBUTO.CD_EMSR,\n\
  \          --TRIBUTO.CD_PCSR                ,\n          TRIBUTO.CD_TIPO_TRNS_BNDR,\n\
  \          TRIBUTO.CD_PRDT_BNDR,\n          TRIBUTO.CD_TIPO_TRNS_BNDR_ORGM,\n  \
  \        TRIBUTO.SG_ORGM_IFMC,\n          TRIBUTO.DT_RFRN_MVMN,\n          TRIBUTO.DT_VNCM_MVMN,\n\
  \          TRIBUTO.CD_TIPO_APRS_TRNS,\n          TRIBUTO.CD_TIPO_FOMA_CBRN_BNDR,\n\
  \          TRIBUTO.CD_TRBT,\n          TRIBUTO.CD_TIPO_ALQT_TRBT\n      ) DADOS_IMP_AGRP_ROUND\n\
  \    GROUP BY\n      DADOS_IMP_AGRP_ROUND.CD_BNDR,\n      DADOS_IMP_AGRP_ROUND.CD_CRDE,\n\
  \      DADOS_IMP_AGRP_ROUND.CD_TIPO_PLTF_PGMN,\n      DADOS_IMP_AGRP_ROUND.DT_RFRN_MVMN,\n\
  \      DADOS_IMP_AGRP_ROUND.DT_VNCM_MVMN\n  ) DADOS_IMPOSTO ON DADOS_IMPOSTO.CD_BNDR\
  \ = DADOS_REMUNERACAO.CD_BNDR\n  AND DADOS_IMPOSTO.CD_CRDE = DADOS_REMUNERACAO.CD_CRDE\n\
  \  AND DADOS_IMPOSTO.CD_TIPO_PLTF_PGMN = DADOS_REMUNERACAO.CD_TIPO_PLTF_PGMN\n \
  \ AND DADOS_IMPOSTO.DT_RFRN_MVMN = DADOS_REMUNERACAO.DT_RFRN_MVMN\n  AND DADOS_IMPOSTO.DT_VNCM_MVMN\
  \ = DADOS_REMUNERACAO.DT_VNCM_MVMN\n  INNER JOIN CCR.TBCCRR_CRDE_BNDR CREDENCIADORA\
  \ ON GRDE.CD_BNDR = CREDENCIADORA.CD_BNDR\n  AND GRDE.CD_CRDE = CREDENCIADORA.CD_CRDE\n\
  WHERE\n  GRDE.DT_RFRN_MVMN = vdataMovimentoAux\ngroup by\n  GRDE.CD_BNDR,\n  GRDE.CD_CRDE,\n\
  \  GRDE.CD_TIPO_PLTF_PGMN,\n  GRDE.DT_RFRN_MVMN,\n  GRDE.DT_VNCM_MVMN,\n  CREDENCIADORA.NU_BNCO_PGMN_CRDE,\n\
  \  DADOS_REMUNERACAO.valor_REM,\n  DADOS_IMPOSTO.valor_TRIBUTO;\nEND IF;\nEND IF;\n\
  COMMIT;\nEXCEPTION\n  WHEN OTHERS THEN RAISE_APPLICATION_ERROR (-20001, SQLCODE\
  \ || ': ' || SQLERRM);\nROLLBACK;\nEND SEL_CGAGRDFINAL;"
