schema: CLC
name: VWCLC_ANLT_CRDE_AGND_EMSR_2711
updatedAllowed: true
insertAllowed: true
viewDefinition: |-
  SELECT
    LNRECB1.DT_RFRN_MVMN AS DT_RFRN_MVMN,
    LNRECB1.DT_VNCM_LQDC_EMSR AS DT_VNCM_LQDC_EMSR,
    LNRECB1.NU_RFRN AS NU_RFRN_RLTR,
    LNRECB1.NU_SQNL AS NU_SQNL,
    crto.NU_BIN_RECB AS NU_BIN_RLTR,
    LNRECB1.CD_BNDR AS CD_BNDR,
    LNRECB1.CD_CRDE AS CD_CRDE,
    LNRECB1.CD_TIPO_PLTF_PGMN AS CD_TIPO_PLTF_PGMN,
    LNRECB1.CD_EMSR AS CD_EMSR_RLTR,
    LNRECB1.CD_PCSR AS CD_PCSR_RLTR,
    LNRECB1.CD_TIPO_TRNS_BNDR_RECB AS CD_TIPO_TRNS_BNDR_RLTR,
    CAST(LNRECB1.CD_TIPO_TRNS_BNDR_RECB AS NUMBER(2)) AS CD_TIPO_TRNS_ORIG,
    LNRECB1.CD_PRDT_BNDR_RECB AS CD_PRDT_BNDR_RLTR,
    NULL AS CD_ERRO_PCSM_LQDC,
    LNRECB1.TX_VALR_ORGM_TRNE_FNDO AS TX_VALR_ORGM_TRNE_FNDO_RLTR,
    LNRECB1.CD_TIPO_APRS_TRNS_RECB AS CD_TIPO_APRS_TRNS_RLTR,
    LNRECB1.CD_MODA_RECB AS CD_MODA_RLTR,
    ttop.CD_TIPO_OPRD AS CD_TIPO_OPRD,
    LNRECB1.CD_RGRA_OPRC_TRNS AS CD_RGRA_OPRC_TRNS,
    CAST(LNRECB1.TX_VALR_TRNS AS VARCHAR(17)) AS TX_VALR_TRNS_RLTR,
    CAST(LNRECB1.TX_VALR_VNDA AS VARCHAR(17)) AS TX_VALR_VNDA,
    CAST(LNRECB1.TX_VALR_TAXA_EMBQ AS VARCHAR(17)) AS TX_VALR_TAXA_EMBQ_RLTR,
    CAST(LNRECB1.VL_ITCM_VNDA AS NUMBER(17, 2)) AS VL_ITCM_VNDA
  FROM
    (
      SELECT
        /*+ USE_HASH(LNRMNR1,LNRECB2) */
        LNRECB2.DT_RFRN_MVMN,
        LNRECB2.CD_BNDR,
        LNRECB2.CD_CRDE,
        LNRECB2.CD_TIPO_PLTF_PGMN,
        LNRECB2.CD_EMSR,
        LNRECB2.CD_PCSR,
        LNRECB2.CD_PRDT_BNDR_RECB,
        LNRECB2.CD_MODA_RECB,
        LNRECB2.CD_TIPO_TRNS_BNDR_RECB,
        LNRECB2.QT_DIA_LQDC_ENVO_EMSR,
        NVL(LNRECB2.NU_RFRN, 0) AS NU_RFRN,
        LNRECB2.CD_ATZC_TRNS,
        LNRECB2.CD_PDV_RECB,
        LNRECB2.NU_CLNT,
        LNRECB2.SG_ORGM_IFMC_RECB,
        LNRECB2.CD_ERRO_PCSM_LQDC_RECB,
        LNRECB2.CD_MCC_BNDR_RECB,
        LNRECB2.TX_DATA_VNDA,
        LNRECB2.SG_TPPS_RECB,
        LNRECB2.IN_RNVO_TRNS,
        LNRECB2.TX_QNTD_TOTL_PRCL,
        LNRECB2.NU_PRCL,
        LNRECB2.TX_VALR_ORGM_TRNE_FNDO,
        LNRECB2.CD_USRO_INCL_RGST,
        LNRECB2.DH_INCL_RGST,
        LNRECB2.TX_QNTD_DIA_LQDC_CRDE_BNDR,
        LNRECB2.QT_DIA_LQDC_BNDR_EMSR,
        LNRECB2.TX_NMRO_CPF_CLNT,
        LNRECB2.TX_NMRO_DV_CPF_CLNT,
        LNRECB2.TX_NMRO_RAIZ_CNPJ_CLNT,
        LNRECB2.TX_NMRO_FILI_CNPJ_CLNT,
        LNRECB2.TX_NMRO_DV_CNPJ_CLNT,
        LNRECB2.CD_TIPO_APRS_TRNS_RECB,
        LNRECB2.TX_VALR_TRNS,
        LNRECB2.CD_TIPO_MVMC_PARC,
        LNRECB2.NU_RMSA_CRDE,
        LNRECB2.NU_RMSA_EMSR,
        LNRECB2.IN_ENVO_ANLT_CRDE_BNDR_EMSR,
        LNRECB2.CD_RGRA_OPRC_TRNS,
        LNRMNR1.CD_GRPO_RMNR,
        LNRMNR1.CD_TIPO_RMNR,
        LNRMNR1.CD_TIPO_TRNS_ORIG,
        LNRMNR1.DT_VNCM_LQDC_PDV,
        LNRMNR1.DT_VNCM_LQDC_EMSR,
        LNRMNR1.CD_SGMT_ITCM,
        LNRMNR1.CD_TIPO_RMNR_ITCM,
        LNRMNR1.CD_TIPO_TRNS_PGMN,
        LNRMNR1.IN_CNGA_TAXA_PDRO,
        LNRMNR1.VL_TRNS_MXMO,
        LNRMNR1.PC_TAXA_ITCM,
        LNRMNR1.VL_TARF_ITCM_TRNS,
        LNRMNR1.VL_MXMO_ITCM_TRNS,
        LNRMNR1.VL_ITCM_TRNS,
        MAX(LNRECB2.NU_SQNL) AS NU_SQNL,
        SUM(LNRECB2.TX_VALR_VNDA) AS TX_VALR_VNDA,
        SUM(LNRECB2.TX_VALR_TAXA_EMBQ) AS TX_VALR_TAXA_EMBQ,
        SUM(LNRMNR1.VL_TARF_ITCM_VNDA) AS VL_TARF_ITCM_VNDA,
        SUM(LNRMNR1.VL_MXMO_ITCM_VNDA) AS VL_MXMO_ITCM_VNDA,
        SUM(LNRMNR1.VL_ITCM_VNDA) AS VL_ITCM_VNDA
      FROM
        CLC.TBCLCR_LNCM_RECB LNRECB2,
        CLC.TBCLCR_LNCM_RECB_RMNR LNRMNR1
      WHERE
        LNRMNR1.CD_BNDR = LNRECB2.CD_BNDR + 0
        AND LNRMNR1.CD_CRDE = LNRECB2.CD_CRDE
        AND LNRMNR1.CD_EMSR = LNRECB2.CD_EMSR
        AND LNRMNR1.NU_SQNL = LNRECB2.NU_SQNL
        AND LNRMNR1.CD_TIPO_PLTF_PGMN = LNRECB2.CD_TIPO_PLTF_PGMN
        AND LNRMNR1.DT_RFRN_MVMN = LNRECB2.DT_RFRN_MVMN + 0
        AND LNRMNR1.NU_RMSA_CRDE = LNRECB2.NU_RMSA_CRDE
        AND LNRMNR1.CD_PCSR = LNRECB2.CD_PCSR
        AND LNRMNR1.NU_RMSA_EMSR = LNRECB2.NU_RMSA_EMSR + 0
        AND LNRMNR1.CD_TIPO_TRNS_BNDR_RECB = LNRECB2.CD_TIPO_TRNS_BNDR_RECB || ''
        AND LNRECB2.SG_ORGM_IFMC_RECB = 'CRD'
        AND NVL(LNRECB2.NU_RFRN, 0) NOT IN 0
        AND NVL(LNRECB2.NU_RFRN, 0) = NVL(LNRMNR1.NU_RFRN, 0)
        AND LNRECB2.IN_ENVO_ANLT_CRDE_BNDR_EMSR = 'S'
        AND LNRMNR1.DT_RFRN_MVMN = (
          SELECT
            DT_PCSM_ATUL
          FROM
            CCR.TBCCRR_CICL_PCSM_CDST TBCCRR_CICL_PCSM_CDST1
        )
        AND LNRECB2.DT_RFRN_MVMN = (
          SELECT
            DT_PCSM_ATUL
          FROM
            CCR.TBCCRR_CICL_PCSM_CDST TBCCRR_CICL_PCSM_CDST2
        )
      GROUP BY
        LNRECB2.DT_RFRN_MVMN,
        LNRECB2.CD_BNDR,
        LNRECB2.CD_CRDE,
        LNRECB2.CD_TIPO_PLTF_PGMN,
        LNRECB2.CD_EMSR,
        LNRECB2.CD_PCSR,
        LNRECB2.CD_PRDT_BNDR_RECB,
        LNRECB2.CD_MODA_RECB,
        LNRECB2.CD_TIPO_TRNS_BNDR_RECB,
        LNRECB2.QT_DIA_LQDC_ENVO_EMSR,
        LNRECB2.NU_RFRN,
        LNRECB2.CD_ATZC_TRNS,
        LNRECB2.CD_PDV_RECB,
        LNRECB2.NU_CLNT,
        LNRECB2.SG_ORGM_IFMC_RECB,
        LNRECB2.CD_ERRO_PCSM_LQDC_RECB,
        LNRECB2.CD_MCC_BNDR_RECB,
        LNRECB2.TX_DATA_VNDA,
        LNRECB2.SG_TPPS_RECB,
        LNRECB2.IN_RNVO_TRNS,
        LNRECB2.TX_QNTD_TOTL_PRCL,
        LNRECB2.NU_PRCL,
        LNRECB2.TX_VALR_ORGM_TRNE_FNDO,
        LNRECB2.CD_USRO_INCL_RGST,
        LNRECB2.DH_INCL_RGST,
        LNRECB2.TX_QNTD_DIA_LQDC_CRDE_BNDR,
        LNRECB2.QT_DIA_LQDC_BNDR_EMSR,
        LNRECB2.TX_NMRO_CPF_CLNT,
        LNRECB2.TX_NMRO_DV_CPF_CLNT,
        LNRECB2.TX_NMRO_RAIZ_CNPJ_CLNT,
        LNRECB2.TX_NMRO_FILI_CNPJ_CLNT,
        LNRECB2.TX_NMRO_DV_CNPJ_CLNT,
        LNRECB2.CD_TIPO_APRS_TRNS_RECB,
        LNRECB2.TX_VALR_TRNS,
        LNRECB2.CD_TIPO_MVMC_PARC,
        LNRECB2.NU_RMSA_CRDE,
        LNRECB2.NU_RMSA_EMSR,
        LNRECB2.IN_ENVO_ANLT_CRDE_BNDR_EMSR,
        LNRECB2.CD_RGRA_OPRC_TRNS,
        LNRMNR1.CD_GRPO_RMNR,
        LNRMNR1 .CD_TIPO_RMNR,
        LNRMNR1.CD_TIPO_TRNS_ORIG,
        LNRMNR1.DT_VNCM_LQDC_PDV,
        LNRMNR1.DT_VNCM_LQDC_EMSR,
        LNRMNR1.CD_SGMT_ITCM,
        LNRMNR1.CD_TIPO_RMNR_ITCM,
        LNRMNR1.CD_TIPO_TRNS_PGMN,
        LNRMNR1.IN_CNGA_TAXA_PDRO,
        LNRMNR1.VL_TRNS_MXMO,
        LNRMNR1.PC_TAXA_ITCM,
        LNRMNR1.VL_TARF_ITCM_TRNS,
        LNRMNR1.VL_MXMO_ITCM_TRNS,
        LNRMNR1.VL_ITCM_TRNS,
        LNRECB2.NU_SQNL
      UNION ALL
      SELECT
        LNRECB3.DT_RFRN_MVMN,
        LNRECB3.CD_BNDR,
        LNRECB3.CD_CRDE,
        LNRECB3.CD_TIPO_PLTF_PGMN,
        LNRECB3.CD_EMSR,
        LNRECB3.CD_PCSR,
        LNRECB3.CD_PRDT_BNDR_RECB,
        LNRECB3.CD_MODA_RECB,
        LNRECB3.CD_TIPO_TRNS_BNDR_RECB,
        LNRECB3.QT_DIA_LQDC_ENVO_EMSR,
        NVL(LNRECB3.NU_RFRN, 0) AS NU_RFRN,
        LNRECB3.CD_ATZC_TRNS,
        LNRECB3.CD_PDV_RECB,
        LNRECB3.NU_CLNT,
        LNRECB3.SG_ORGM_IFMC_RECB,
        LNRECB3.CD_ERRO_PCSM_LQDC_RECB,
        LNRECB3.CD_MCC_BNDR_RECB,
        LNRECB3.TX_DATA_VNDA,
        LNRECB3.SG_TPPS_RECB,
        LNRECB3.IN_RNVO_TRNS,
        LNRECB3.TX_QNTD_TOTL_PRCL,
        LNRECB3.NU_PRCL,
        LNRECB3.TX_VALR_ORGM_TRNE_FNDO,
        LNRECB3.CD_USRO_INCL_RGST,
        LNRECB3.DH_INCL_RGST,
        LNRECB3.TX_QNTD_DIA_LQDC_CRDE_BNDR,
        LNRECB3.QT_DIA_LQDC_BNDR_EMSR,
        LNRECB3.TX_NMRO_CPF_CLNT,
        LNRECB3.TX_NMRO_DV_CPF_CLNT,
        LNRECB3.TX_NMRO_RAIZ_CNPJ_CLNT,
        LNRECB3.TX_NMRO_FILI_CNPJ_CLNT,
        LNRECB3.TX_NMRO_DV_CNPJ_CLNT,
        LNRECB3.CD_TIPO_APRS_TRNS_RECB,
        LNRECB3.TX_VALR_TRNS,
        LNRECB3.CD_TIPO_MVMC_PARC,
        LNRECB3.NU_RMSA_CRDE,
        LNRECB3.NU_RMSA_EMSR,
        LNRECB3.IN_ENVO_ANLT_CRDE_BNDR_EMSR,
        LNRECB3.CD_RGRA_OPRC_TRNS,
        LNRMNR2.CD_GRPO_RMNR,
        LNRMNR2.CD_TIPO_RMNR,
        LNRMNR2.CD_TIPO_TRNS_ORIG,
        LNRMNR2.DT_VNCM_LQDC_PDV,
        LNRMNR2.DT_VNCM_LQDC_EMSR,
        LNRMNR2.CD_SGMT_ITCM,
        LNRMNR2.CD_TIPO_RMNR_ITCM,
        LNRMNR2.CD_TIPO_TRNS_PGMN,
        LNRMNR2.IN_CNGA_TAXA_PDRO,
        LNRMNR2.VL_TRNS_MXMO,
        LNRMNR2.PC_TAXA_ITCM,
        LNRMNR2.VL_TARF_ITCM_TRNS,
        LNRMNR2.VL_MXMO_ITCM_TRNS,
        LNRMNR2.VL_ITCM_TRNS,
        LNRECB3.NU_SQNL,
        CAST(LNRECB3.TX_VALR_VNDA AS INT) AS TX_VALR_VNDA,
        CAST(LNRECB3.TX_VALR_TAXA_EMBQ AS INT) AS TX_VALR_TAXA_EMBQ,
        LNRMNR2.VL_TARF_ITCM_VNDA,
        LNRMNR2.VL_MXMO_ITCM_VNDA,
        LNRMNR2.VL_ITCM_VNDA
      FROM
        CLC.TBCLCR_LNCM_RECB LNRECB3,
        CLC.TBCLCR_LNCM_RECB_RMNR LNRMNR2
      WHERE
        LNRECB3.CD_BNDR = LNRMNR2.CD_BNDR (+)
        AND LNRECB3.CD_CRDE = LNRMNR2.CD_CRDE (+)
        AND LNRECB3.CD_EMSR = LNRMNR2.CD_EMSR (+)
        AND LNRECB3.NU_SQNL = LNRMNR2.NU_SQNL (+)
        AND LNRECB3.CD_TIPO_PLTF_PGMN = LNRMNR2.CD_TIPO_PLTF_PGMN (+)
        AND LNRECB3.DT_RFRN_MVMN = LNRMNR2.DT_RFRN_MVMN (+)
        AND LNRECB3.NU_RMSA_CRDE = LNRMNR2.NU_RMSA_CRDE (+)
        AND LNRECB3.CD_PCSR = LNRMNR2.CD_PCSR (+)
        AND LNRECB3.NU_RMSA_EMSR = LNRMNR2.NU_RMSA_EMSR (+)
        AND LNRECB3.CD_TIPO_TRNS_BNDR_RECB = LNRMNR2.CD_TIPO_TRNS_BNDR_RECB (+)
        AND LNRECB3.SG_ORGM_IFMC_RECB = 'CRD'
        AND NVL(LNRECB3.NU_RFRN, 0) = NVL(LNRMNR2.NU_RFRN, 0)
        AND LNRECB3.IN_ENVO_ANLT_CRDE_BNDR_EMSR = 'S'
        AND NVL(LNRMNR2.NU_RFRN, 0) IN 0
        AND LNRMNR2.DT_RFRN_MVMN = (
          SELECT
            DT_PCSM_ATUL
          FROM
            CCR.TBCCRR_CICL_PCSM_CDST TBCCRR_CICL_PCSM_CDST3
        )
        AND LNRECB3.DT_RFRN_MVMN = (
          SELECT
            DT_PCSM_ATUL
          FROM
            CCR.TBCCRR_CICL_PCSM_CDST TBCCRR_CICL_PCSM_CDST4
        )
    ) LNRECB1,
    CLC.TBCLCR_TIPO_TRNS_OPRD ttop,
    CLC.TBCLCR_CRTO_CRPT_LNCM_RECB crto
  WHERE
    LNRECB1.CD_BNDR = ttop.CD_BNDR
    AND LNRECB1.CD_TIPO_TRNS_BNDR_RECB = ttop.CD_TIPO_TRNS_BNDR
    AND LNRECB1.CD_TIPO_TRNS_BNDR_RECB = ttop.CD_TIPO_TRNS_BNDR_ORGM
    AND NVL(LNRECB1.CD_TIPO_MVMC_PARC, 0) = NVL(ttop.CD_TIPO_MVMC_PARC, 0)
    AND ttop.SG_ORGM_IFMC = 'CRD'
    AND LNRECB1.SG_ORGM_IFMC_RECB = ttop.SG_ORGM_IFMC
    AND LNRECB1.CD_BNDR = crto.CD_BNDR
    AND LNRECB1.DT_RFRN_MVMN = crto.DT_RFRN_MVMN
    AND LNRECB1.CD_TIPO_PLTF_PGMN = crto.CD_TIPO_PLTF_PGMN
    AND LNRECB1.CD_CRDE = crto.CD_CRDE
    AND LNRECB1.NU_RMSA_CRDE = crto.NU_RMSA_CRDE
    AND LNRECB1.CD_EMSR = crto.CD_EMSR
    AND LNRECB1.CD_PCSR = crto.CD_PCSR
    AND LNRECB1.NU_RMSA_EMSR = crto.NU_RMSA_EMSR
    AND LNRECB1.NU_SQNL = crto.NU_SQNL
    AND crto.CD_TIPO_CNCT_CRTO = 1
  ORDER BY
    TTOP.CD_BNDR
columns: []
referencedTables: []
