schema: APEX_050000
name: WWV_FLOW_FILES
updatedAllowed: true
insertAllowed: true
viewDefinition: |-
  select
    id,
    flow_id,
    name,
    filename,
    title,
    mime_type,
    doc_size,
    dad_charset,
    created_by,
    created_on,
    updated_by,
    updated_on,
    last_updated,
    content_type,
    blob_content,
    language,
    description,
    file_type,
    file_charset
  from
    wwv_flow_current_sgid sgid,
    wwv_flow_file_objects$ a
  where
    a .security_group_id = sgid.security_group_id
    and session_id is null
    and (
      file_type is null
      or file_type not in ('IMAGE_FILE', 'CSS_FILE', 'STATIC_FILE')
      /* files are now stored in wwv_flow_static_files and wwv_flow_company_static_files */
      or (
        /* include legacy static files which don't exist in the workspace and app static file table anymore, because wwv_flow_file_mgr.get_file
                         will still access them in fallback mode (bug #20729418)
                      */
        file_type in ('IMAGE_FILE', 'CSS_FILE', 'STATIC_FILE')
        and (
          (
            flow_id = 0
            and not exists (
              select
                1
              from
                wwv_flow_company_static_files
              where
                security_group_id = a .security_group_id
                and file_name = a .filename
            )
          )
          or (
            flow_id <> 0
            and not exists (
              select
                1
              from
                wwv_flow_static_files
              where
                security_group_id = a .security_group_id
                and flow_id = a .flow_id
                and file_name = a .filename
            )
          )
        )
      )
    )
  union all
  select
    id,
    flow_id,
    to_char(id) || '/' || file_name as name,
    file_name,
    null as title,
    mime_type,
    sys.dbms_lob.getlength(file_content) as doc_size,
    null as dad_charset,
    created_by,
    created_on,
    last_updated_by,
    last_updated_on,
    last_updated_on,
    null as content_type,
    file_content,
    null as language,
    null as description,
    case
      when upper(mime_type) like 'IMAGE%' then 'IMAGE_FILE'
      when upper(mime_type) = 'TEXT/CSS' then 'CSS_FILE'
      else 'STATIC_FILE'
    end as file_type,
    file_charset
  from
    wwv_flow_static_files
  where
    security_group_id = (
      select
        wwv_flow.get_sgid
      from
        sys.dual
    )
  union all
  select
    id,
    0 as flow_id,
    to_char(id) || '/' || file_name as name,
    file_name,
    null as title,
    mime_type,
    sys.dbms_lob.getlength(file_content) as doc_size,
    null as dad_charset,
    created_by,
    created_on,
    last_updated_by,
    last_updated_on,
    last_updated_on,
    null as content_type,
    file_content,
    null as language,
    null as description,
    case
      when upper(mime_type) like 'IMAGE%' then 'IMAGE_FILE'
      when upper(mime_type) = 'TEXT/CSS' then 'CSS_FILE'
      else 'STATIC_FILE'
    end as file_type,
    file_charset
  from
    wwv_flow_company_static_files
  where
    security_group_id = (
      select
        wwv_flow.get_sgid
      from
        sys.dual
    )
columns: []
referencedTables: []
